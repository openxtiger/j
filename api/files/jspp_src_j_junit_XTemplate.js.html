<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jspp/src/j/junit/XTemplate.js - The Js++ Language</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/logo.png">The Js++ Language: jspp/src/j/junit/XTemplate.js</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Modules</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../modules/DOM_UNIT.html">DOM_UNIT</a>
                
                </li>
            
                <li><a href="../modules/jui.html">jui</a>
                
                </li>
            
                <li><a href="../modules/junit.html">junit</a>
                
                </li>
            
                <li><a href="../modules/OOP.html">OOP</a>
                
                </li>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Classes</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/dataview.html">dataview</a></li>
            
                <li><a href="../classes/Jclass.html">Jclass</a></li>
            
                <li><a href="../classes/jde.DataProxy.html">jde.DataProxy</a></li>
            
                <li><a href="../classes/jde.JsonReader.html">jde.JsonReader</a></li>
            
                <li><a href="../classes/JDEngine.html">JDEngine</a></li>
            
                <li><a href="../classes/jdengine.html">jdengine</a></li>
            
                <li><a href="../classes/jsonreader.html">jsonreader</a></li>
            
                <li><a href="../classes/jui.Component.html">jui.Component</a></li>
            
                <li><a href="../classes/jui.DataView.html">jui.DataView</a></li>
            
                <li><a href="../classes/jui.form.Checkbox.html">jui.form.Checkbox</a></li>
            
                <li><a href="../classes/jui.form.ComboBox.html">jui.form.ComboBox</a></li>
            
                <li><a href="../classes/jui.form.Field.html">jui.form.Field</a></li>
            
                <li><a href="../classes/jui.form.Hidden.html">jui.form.Hidden</a></li>
            
                <li><a href="../classes/jui.form.NumberFiled.html">jui.form.NumberFiled</a></li>
            
                <li><a href="../classes/jui.form.Radio.html">jui.form.Radio</a></li>
            
                <li><a href="../classes/jui.form.TextArea.html">jui.form.TextArea</a></li>
            
                <li><a href="../classes/jui.form.TextField.html">jui.form.TextField</a></li>
            
                <li><a href="../classes/jui.form.TriggerField.html">jui.form.TriggerField</a></li>
            
                <li><a href="../classes/jui.form.TwinTriggerField.html">jui.form.TwinTriggerField</a></li>
            
                <li><a href="../classes/jui.Layer.html">jui.Layer</a></li>
            
                <li><a href="../classes/junit.BaseTemplate.html">junit.BaseTemplate</a></li>
            
                <li><a href="../classes/junit.JTemplate.html">junit.JTemplate</a></li>
            
                <li><a href="../classes/junit.MixedCollection.html">junit.MixedCollection</a></li>
            
                <li><a href="../classes/junit.Observable.html">junit.Observable</a></li>
            
                <li><a href="../classes/junit.STemplate.html">junit.STemplate</a></li>
            
                <li><a href="../classes/junit.Template.html">junit.Template</a></li>
            
                <li><a href="../classes/Opp.html">Opp</a></li>
            
        </ul>
    </div>
</div>










<div id="fileTree" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Files</h2>
    </div>
    <div class="bd">
        <ul><li>jspp/<ul><li>src/<ul><li>core/<ul><li><a href="../files/jspp_src_core_j.js.html">j.js</a></li><li><a href="../files/jspp_src_core_oop.js.html">oop.js</a></li></ul></li><li>j/<ul><li>jde/<ul><li><a href="../files/jspp_src_j_jde_DataProxy.js.html">DataProxy.js</a></li><li><a href="../files/jspp_src_j_jde_JDEngine.js.html">JDEngine.js</a></li><li><a href="../files/jspp_src_j_jde_JsonReader.js.html">JsonReader.js</a></li></ul></li><li>jui/<ul><li><a href="../files/jspp_src_j_jui_Component.js.html">Component.js</a></li><li><a href="../files/jspp_src_j_jui_DataView.js.html">DataView.js</a></li><li><a href="../files/jspp_src_j_jui_Layer.js.html">Layer.js</a></li><li>form/<ul><li><a href="../files/jspp_src_j_jui_form_Checkbox.js.html">Checkbox.js</a></li><li><a href="../files/jspp_src_j_jui_form_ComboBox.js.html">ComboBox.js</a></li><li><a href="../files/jspp_src_j_jui_form_Field.js.html">Field.js</a></li><li><a href="../files/jspp_src_j_jui_form_Hidden.js.html">Hidden.js</a></li><li><a href="../files/jspp_src_j_jui_form_NumberField.js.html">NumberField.js</a></li><li><a href="../files/jspp_src_j_jui_form_Radio.js.html">Radio.js</a></li><li><a href="../files/jspp_src_j_jui_form_TextArea.js.html">TextArea.js</a></li><li><a href="../files/jspp_src_j_jui_form_TextField.js.html">TextField.js</a></li><li><a href="../files/jspp_src_j_jui_form_TriggerField.js.html">TriggerField.js</a></li></ul></li></ul></li><li>junit/<ul><li><a href="../files/jspp_src_j_junit_MixedCollection.js.html">MixedCollection.js</a></li><li><a href="../files/jspp_src_j_junit_Observable.js.html">Observable.js</a></li><li><a href="../files/jspp_src_j_junit_Template.js.html">Template.js</a></li><li><a href="../files/jspp_src_j_junit_XTemplate.js.html">XTemplate.js</a></li></ul></li></ul></li></ul></li></ul></li></ul>
    </div>
</div>



        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>jspp/src/j/junit/XTemplate.js</h4>

<pre class="code prettyprint linenums">
/**
 * @pakcage junit
 * @module junit
 */
&#x27;package junit&#x27;.j(function () {

    /**
     * @class junit.STemplate
     */
    &#x27;class STemplate extends BaseTemplate&#x27;.j(function () {
        var re = /\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,
            compileARe = /\\/g,
            compileBRe = /(\r\n|\n)/g,
            compileCRe = /&#x27;/g;
        //
        jpublic({
            apply: function (values) {
                console.log(values);
                var me = this;
                if (me.compiled) {
                    return me.compiled.call(this, values);
                }
                function fn(m, name, format, args) {
                    if (format) {
                        if (args) {
                            args = [values[name]].concat(Function.prototype.constructor.apply(Function.prototype,
                                &#x27;return [&#x27; + args + &#x27;];&#x27;)());
                        } else {
                            args = [values[name]];
                        }
                        if (format.substr(0, 1) == &quot;$&quot;) {
                            return $[format.substr(1)].apply($, args);
                        } else {
                            return me[format].apply(me, args);
                        }
                    }
                    else {
                        return values[name] !== undefined ? values[name] : &quot;&quot;;
                    }
                }

                return me.html.replace(re, fn);
            },
            set: function (html, compile) {
                var me = this;
                me.html = html;
                me.compiled = null;
                return compile ? me.compile() : me;
            },
            compile: function () {
                var me = this,
                    body, bodyReturn;

                function fn(m, name, format, args) {
                    if (format) {
                        args = args ? &#x27;,&#x27; + args : &quot;&quot;;
                        if (format.substr(0, 1) == &quot;$&quot;) {
                            format = &quot;$.&quot; + format.substr(1) + &#x27;(&#x27;;
                        } else {
                            format = &#x27;this.&#x27; + format + &#x27;(&#x27;;
                        }
                    }
                    else {
                        args = &#x27;&#x27;;
                        format = &quot;(values[&#x27;&quot; + name + &quot;&#x27;] == undefined ? &#x27;&#x27; : &quot;;
                    }
                    return &quot;&#x27;,&quot; + format + &quot;values[&#x27;&quot; + name + &quot;&#x27;]&quot; + args + &quot;) ,&#x27;&quot;;
                }

                bodyReturn = me.html.replace(compileARe, &#x27;\\\\&#x27;).replace(compileBRe, &#x27;\\n&#x27;).
                    replace(compileCRe, &quot;\\&#x27;&quot;).replace(re, fn);
                body = &quot;this.compiled = function(values){ return [&#x27;&quot; + bodyReturn + &quot;&#x27;];};&quot;;
                eval(body);
                return me;
            }
        });


    });

    /**
     * @class junit.Template
     */
    &#x27;class Template extends BaseTemplate&#x27;.j(function () {
        var codeRe = /\{\[((?:\\\]|.|\n)*?)\]\}/g,
            evalRe = /&lt;%((?:\\\]|.|\n)*?)%&gt;/g,
            re = /\{([\w\.#\$\-]+)(?::([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\\]\s?[\d\.\+\-\*\\\(\)]+)?\}/g;

        function applySubTemplate(id, values, parent, xindex, xcount) {
            var me = this,
                len,
                t = me.tpls[id],
                vs,
                buf = [];


            var compiled = t.compiled;
            if ((t.test &amp;&amp; !t.test.call(me, values, parent, xindex, xcount)) ||
                (t.exec &amp;&amp; t.exec.call(me, values, parent, xindex, xcount))) {
                if (!t.ecompiled) return &#x27;&#x27;;
                compiled = t.ecompiled;
            }

            vs = t.target ? t.target.call(me, values, parent) : values;
            parent = t.target ? values : parent;
            len = vs.length;

            if (t.target &amp;&amp; $.isArray(vs)) {
                $.each(vs, function (v, i) {
                    buf[buf.length] = compiled.call(me, v, parent, i + 1, len);
                });
                return buf.join(&#x27;&#x27;);
            }
            return compiled.call(me, vs, parent, xindex, xcount);
        }

        function compileTpl(tpl) {
            var body;

            function fn(m, name, format, args, math) {
                if (name.substr(0, 4) == &#x27;xtpl&#x27;) {
                    return &quot;&#x27;,applySubTemplate.call(this, &quot; + name.substr(4) + &quot;, values, parent, xindex, xcount),&#x27;&quot;;
                }
                var v;
                if (name === &#x27;.&#x27;) {
                    v = &#x27;values&#x27;;
                } else if (name === &#x27;#&#x27;) {
                    v = &#x27;xindex&#x27;;
                } else if (name === &#x27;$&#x27;) {
                    v = &#x27;xcount&#x27;;
                } else if (name.substr(0, 2) == &quot;..&quot;) {
                    v = &#x27;parent&#x27; + name.substr(1);
                }
                else if (name.indexOf(&#x27;.&#x27;) != -1) {
                    v = &quot;values.&quot; + name;
                } else {
                    v = &quot;values[&#x27;&quot; + name + &quot;&#x27;]&quot;;
                }
                if (math) {
                    v = &#x27;(&#x27; + v + math + &#x27;)&#x27;;
                }
                if (format) {
                    args = args ? &#x27;,&#x27; + args : &quot;&quot;;
                    if (format.substr(0, 1) == &quot;$&quot;) {
                        format = &quot;$[&#x27;&quot; + format.substr(1) + &quot;&#x27;](&quot;;
                    } else {
                        format = &quot;this[&#x27;&quot; + format + &quot;&#x27;](&quot;;
                    }
                } else {
                    args = &#x27;&#x27;;
                    format = &quot;(&quot; + v + &quot; === undefined ? &#x27;&#x27; : &quot;;
                }
                return &quot;&#x27;,&quot; + format + v + args + &quot;),&#x27;&quot;;
            }

            function codeFn(m, code) {
                return &quot;&#x27;,(&quot; + code.replace(/\\&#x27;/g, &quot;&#x27;&quot;) + &quot;),&#x27;&quot;;
            }

            function evalFn(m, code) {
                return &quot;&#x27;,&#x27;&quot; + code.replace(/\\&#x27;/g, &quot;&#x27;&quot;) + &quot;&#x27;,&#x27;&quot;;
            }

            var sbody = tpl.body.split(&quot;&lt;else&gt;&quot;);

            body = [&quot;tpl.compiled = function(values, parent, xindex, xcount){ return [&#x27;&quot;];
            body.push(sbody[0].replace(/(\r\n|\n)/g, &#x27;\\n&#x27;).replace(/&#x27;/g, &quot;\\&#x27;&quot;)
                .replace(re, fn).replace(codeRe, codeFn));
            body.push(&quot;&#x27;].join(&#x27;&#x27;);};&quot;);
            body = body.join(&#x27;&#x27;);
            eval(body);
            if (sbody.length &gt; 1) {
                body = [&quot;tpl.ecompiled = function(values, parent, xindex, xcount){ return [&#x27;&quot;];
                body.push(sbody[1].replace(/(\r\n|\n)/g, &#x27;\\n&#x27;).replace(/&#x27;/g, &quot;\\&#x27;&quot;)
                    .replace(re, fn).replace(codeRe, codeFn));
                body.push(&quot;&#x27;].join(&#x27;&#x27;);};&quot;);
                body = body.join(&#x27;&#x27;);

                eval(body);
            }
            return this;
        }

        //
        jpublic({
            constructor: function () {
                jsuper(this);

                var me = this;
                var s = me.html,
                    re = /&lt;tpl\b[^&gt;]*&gt;((?:(?=([^&lt;]+))\2|&lt;(?!tpl\b[^&gt;]*&gt;))*?)&lt;\/tpl&gt;/,
                    nameRe = /^&lt;tpl\b[^&gt;]*?for=[&#x27;&quot;](.*?)[&#x27;&quot;]/,
                    ifRe = /^&lt;tpl\b[^&gt;]*?if=[&#x27;&quot;](.*?)[&#x27;&quot;]/,
                    execRe = /^&lt;tpl\b[^&gt;]*?exec=[&#x27;&quot;](.*?)[&#x27;&quot;]/,
                    m,
                    id = 0,
                    tpls = [],
                    VALUES = &#x27;values&#x27;,
                    PARENT = &#x27;parent&#x27;,
                    XINDEX = &#x27;xindex&#x27;,
                    XCOUNT = &#x27;xcount&#x27;,
                    RETURN = &#x27;return &#x27;,
                    WITHVALUES = &#x27;with(values){ &#x27;;

                s = [&#x27;&lt;tpl&gt;&#x27;, s, &#x27;&lt;/tpl&gt;&#x27;].join(&#x27;&#x27;);

                while ((m = s.match(re))) {
                    var m2 = m[0].match(nameRe),
                        m3 = m[0].match(ifRe),
                        m4 = m[0].match(execRe),
                        exp = null,
                        fn = null,
                        exec = null,
                        name = m2 &amp;&amp; m2[1] ? m2[1] : &#x27;&#x27;;
                    if (m3) {
                        exp = m3 &amp;&amp; m3[1] ? m3[1] : null;
                        if (exp) {
                            fn = new Function(VALUES, PARENT, XINDEX, XCOUNT, WITHVALUES + RETURN + ($.htmlDecode(exp)) + &#x27;; }&#x27;);
                        }
                    }
                    if (m4) {
                        exp = m4 &amp;&amp; m4[1] ? m4[1] : null;
                        if (exp) {
                            exec = new Function(VALUES, PARENT, XINDEX, XCOUNT, WITHVALUES + ($.htmlDecode(exp)) + &#x27;; }&#x27;);
                        }
                    }
                    if (name) {
                        switch (name) {
                            case &#x27;.&#x27;:
                                name = new Function(VALUES, PARENT, WITHVALUES + RETURN + VALUES + &#x27;; }&#x27;);
                                break;
                            case &#x27;..&#x27;:
                                name = new Function(VALUES, PARENT, WITHVALUES + RETURN + PARENT + &#x27;; }&#x27;);
                                break;
                            default:
                                name = new Function(VALUES, PARENT, WITHVALUES + RETURN + name + &#x27;; }&#x27;);
                        }
                    }
                    tpls.push({
                        id: id,
                        target: name,
                        exec: exec,
                        test: fn,
                        body: m[1] || &#x27;&#x27;
                    });
                    s = s.replace(m[0], &#x27;{xtpl&#x27; + id + &#x27;}&#x27;);
                    ++id;
                }
                $.each(tpls, function (t) {
                    compileTpl.call(me, t);
                });

                me.master = tpls[tpls.length - 1];
                me.tpls = tpls;
            },
            apply: function (values) {
                return this.master.compiled.call(this, values, {}, 1, 1);
            },

            compile: function () {
                return this;
            }
        });
    });

    $.extend(function ($) {
        return {
            stpl: function (tpl) {
                var buf = [];
                var args = {};
                if ($.isArray(tpl)) {
                    tpl = tpl.join(&quot;&quot;);
                } else if (arguments.length &gt; 1) {
                    $.each(arguments, function (v) {
                        if ($.isObject(v)) {
                            $.extend(args, v);
                        } else {
                            buf.push(v);
                        }
                    });
                    tpl = buf.join(&#x27;&#x27;);
                }
                return new junit.STemplate(tpl, args);
            },
            tpl: function (tpl) {
                var buf = [];
                var args = {};
                if ($.isArray(tpl)) {
                    tpl = tpl.join(&quot;&quot;);
                } else if (arguments.length &gt; 1) {
                    $.each(arguments, function (v) {
                        if ($.isObject(v)) {
                            $.extend(args, v);
                        } else {
                            buf.push(v);
                        }
                    });
                    tpl = buf.join(&#x27;&#x27;);
                }
                return new junit.Template(tpl, args);
            }
        }

    }($));
});
</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
