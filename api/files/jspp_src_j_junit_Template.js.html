<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jspp/src/j/junit/Template.js - The Js++ Language</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/logo.png">The Js++ Language: jspp/src/j/junit/Template.js</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Modules</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../modules/DOM_UNIT.html">DOM_UNIT</a>
                
                </li>
            
                <li><a href="../modules/jui.html">jui</a>
                
                </li>
            
                <li><a href="../modules/junit.html">junit</a>
                
                </li>
            
                <li><a href="../modules/OOP.html">OOP</a>
                
                </li>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Classes</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/dataview.html">dataview</a></li>
            
                <li><a href="../classes/Jclass.html">Jclass</a></li>
            
                <li><a href="../classes/jde.DataProxy.html">jde.DataProxy</a></li>
            
                <li><a href="../classes/jde.JsonReader.html">jde.JsonReader</a></li>
            
                <li><a href="../classes/JDEngine.html">JDEngine</a></li>
            
                <li><a href="../classes/jdengine.html">jdengine</a></li>
            
                <li><a href="../classes/jsonreader.html">jsonreader</a></li>
            
                <li><a href="../classes/jui.Component.html">jui.Component</a></li>
            
                <li><a href="../classes/jui.DataView.html">jui.DataView</a></li>
            
                <li><a href="../classes/jui.form.Checkbox.html">jui.form.Checkbox</a></li>
            
                <li><a href="../classes/jui.form.ComboBox.html">jui.form.ComboBox</a></li>
            
                <li><a href="../classes/jui.form.Field.html">jui.form.Field</a></li>
            
                <li><a href="../classes/jui.form.Hidden.html">jui.form.Hidden</a></li>
            
                <li><a href="../classes/jui.form.NumberFiled.html">jui.form.NumberFiled</a></li>
            
                <li><a href="../classes/jui.form.Radio.html">jui.form.Radio</a></li>
            
                <li><a href="../classes/jui.form.TextArea.html">jui.form.TextArea</a></li>
            
                <li><a href="../classes/jui.form.TextField.html">jui.form.TextField</a></li>
            
                <li><a href="../classes/jui.form.TriggerField.html">jui.form.TriggerField</a></li>
            
                <li><a href="../classes/jui.form.TwinTriggerField.html">jui.form.TwinTriggerField</a></li>
            
                <li><a href="../classes/jui.Layer.html">jui.Layer</a></li>
            
                <li><a href="../classes/junit.BaseTemplate.html">junit.BaseTemplate</a></li>
            
                <li><a href="../classes/junit.JTemplate.html">junit.JTemplate</a></li>
            
                <li><a href="../classes/junit.MixedCollection.html">junit.MixedCollection</a></li>
            
                <li><a href="../classes/junit.Observable.html">junit.Observable</a></li>
            
                <li><a href="../classes/junit.STemplate.html">junit.STemplate</a></li>
            
                <li><a href="../classes/junit.Template.html">junit.Template</a></li>
            
                <li><a href="../classes/Opp.html">Opp</a></li>
            
        </ul>
    </div>
</div>










<div id="fileTree" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Files</h2>
    </div>
    <div class="bd">
        <ul><li>jspp/<ul><li>src/<ul><li>core/<ul><li><a href="../files/jspp_src_core_j.js.html">j.js</a></li><li><a href="../files/jspp_src_core_oop.js.html">oop.js</a></li></ul></li><li>j/<ul><li>jde/<ul><li><a href="../files/jspp_src_j_jde_DataProxy.js.html">DataProxy.js</a></li><li><a href="../files/jspp_src_j_jde_JDEngine.js.html">JDEngine.js</a></li><li><a href="../files/jspp_src_j_jde_JsonReader.js.html">JsonReader.js</a></li></ul></li><li>jui/<ul><li><a href="../files/jspp_src_j_jui_Component.js.html">Component.js</a></li><li><a href="../files/jspp_src_j_jui_DataView.js.html">DataView.js</a></li><li><a href="../files/jspp_src_j_jui_Layer.js.html">Layer.js</a></li><li>form/<ul><li><a href="../files/jspp_src_j_jui_form_Checkbox.js.html">Checkbox.js</a></li><li><a href="../files/jspp_src_j_jui_form_ComboBox.js.html">ComboBox.js</a></li><li><a href="../files/jspp_src_j_jui_form_Field.js.html">Field.js</a></li><li><a href="../files/jspp_src_j_jui_form_Hidden.js.html">Hidden.js</a></li><li><a href="../files/jspp_src_j_jui_form_NumberField.js.html">NumberField.js</a></li><li><a href="../files/jspp_src_j_jui_form_Radio.js.html">Radio.js</a></li><li><a href="../files/jspp_src_j_jui_form_TextArea.js.html">TextArea.js</a></li><li><a href="../files/jspp_src_j_jui_form_TextField.js.html">TextField.js</a></li><li><a href="../files/jspp_src_j_jui_form_TriggerField.js.html">TriggerField.js</a></li></ul></li></ul></li><li>junit/<ul><li><a href="../files/jspp_src_j_junit_MixedCollection.js.html">MixedCollection.js</a></li><li><a href="../files/jspp_src_j_junit_Observable.js.html">Observable.js</a></li><li><a href="../files/jspp_src_j_junit_Template.js.html">Template.js</a></li><li><a href="../files/jspp_src_j_junit_XTemplate.js.html">XTemplate.js</a></li></ul></li></ul></li></ul></li></ul></li></ul>
    </div>
</div>



        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>jspp/src/j/junit/Template.js</h4>

<pre class="code prettyprint linenums">
/**
 * @pakcage junit
 * @module junit
 */
&#x27;package junit&#x27;.j(function () {

    /**
     * @class junit.BaseTemplate
     */
    &#x27;class BaseTemplate&#x27;.j({
        constructor: function (html, args) {
            var me = this;
            $.extend(me, args);
            me.html = html;
            if (me.compiled) {
                me.compile();
            }
        },

        insertFirst: function (el, values) {
            return this.doInsert(&#x27;afterBegin&#x27;, el, values);
        },

        insertBefore: function (el, values) {
            return this.doInsert(&#x27;beforeBegin&#x27;, el, values);
        },

        insertAfter: function (el, values) {
            return this.doInsert(&#x27;afterEnd&#x27;, el, values);
        },

        append: function (el, values) {
            return this.doInsert(&#x27;beforeEnd&#x27;, el, values);
        },

        doInsert: function (where, el, values) {
            el = $.dom(el);
            return $.insertHtml(where, el, this.apply(values));
        },

        overwrite: function (el, values, returnElement) {
            el = $.dom(el);
            el.innerHTML = this.apply(values);
            return returnElement ? $.get(el.firstChild) : el.firstChild;
        }
    });

    /**
     * @class junit.JTemplate
     */
    &#x27;class JTemplate extends BaseTemplate&#x27;.j(function () {
        var _cache = {};

        var KEYWORDS =
            &#x27;break,case,catch,continue,debugger,default,delete,do,else,false&#x27;
                + &#x27;,finally,for,function,if,in,instanceof,new,null,return,switch,this&#x27;
                + &#x27;,throw,true,try,typeof,var,void,while,with&#x27;

                + &#x27;,abstract,boolean,byte,char,class,const,double,enum,export,extends&#x27;
                + &#x27;,final,float,goto,implements,import,int,interface,long,native&#x27;
                + &#x27;,package,private,protected,public,short,static,super,synchronized&#x27;
                + &#x27;,throws,transient,volatile&#x27;

                + &#x27;,arguments,let,yield&#x27;

                + &#x27;,undefined&#x27;;
        // reg , // ,
        var REMOVE_RE = /\/\*(?:.|\n)*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|&#x27;[^&#x27;]*&#x27;|&quot;[^&quot;]*&quot;|[$\w]+(?:\.[\w]+)+|_[$\w]+/g;
        var SPLIT_RE = /[^\w$]+/g;
        var KEYWORDS_RE = new RegExp([&quot;\\b&quot; + KEYWORDS.replace(/,/g, &#x27;\\b|\\b&#x27;) + &quot;\\b&quot;].join(&#x27;|&#x27;), &#x27;g&#x27;);
        var NUMBER_RE = /\b\d[^,]*/g;
        var BOUNDARY_RE = /^,+|,+$/g;
        var getVariable = function (code) {
            code = code
                .replace(REMOVE_RE, &#x27;&#x27;)
                .replace(SPLIT_RE, &#x27;,&#x27;)
                .replace(KEYWORDS_RE, &#x27;&#x27;)
                .replace(NUMBER_RE, &#x27;&#x27;)
                .replace(BOUNDARY_RE, &#x27;&#x27;);
            code = code ? code.split(/,+/) : [];

            return code;
        };

        var isNewEngine = &#x27;&#x27;.trim;// &#x27;__proto__&#x27; in {}
        var replaces = isNewEngine
            ? [&quot;__=&#x27;&#x27;;&quot;, &quot;__+=&quot;, &quot;;&quot;, &quot;__&quot;]
            : [&quot;__=[];&quot;, &quot;__.push(&quot;, &quot;);&quot;, &quot;__.join(&#x27;&#x27;)&quot;];

        var concat = isNewEngine
            ? &quot;if(content!==undefined){__+=content;return content}&quot;
            : &quot;__.push(content);&quot;;

        var print = &quot;function(content){&quot; + concat + &quot;}&quot;;

        var include = &quot;function(id,data){&quot;
            + &quot;if(data===undefined){data=jdata};&quot;
            + &quot;var content = jstatic().apply(id,data);&quot;
            + concat
            + &quot;}&quot;;

        function html(code, js) {


            if (js.isCompress) {
                code = code.replace(/[\n\r\t\s]+/g, &#x27; &#x27;);
            }

            code = code
                .replace(/(&#x27;|\\)/g, &#x27;\\$1&#x27;)
                .replace(/\r/g, &#x27;\\r&#x27;)
                .replace(/\n/g, &#x27;\\n&#x27;);

            code = replaces[1] + &quot;&#x27;&quot; + code + &quot;&#x27;&quot; + replaces[2];

            return code + &#x27;\n&#x27;;
        }

        function logic(code, js, getKey, jthis) {

            if (js.parser) {
                code = js.parser(code);
                if ($.isArray(code)) {
                    return code[0];
                }
            }

            //#inlude
            if (code.indexOf(&#x27;#&#x27;) === 0) {
                code = jstatic().include(code.substr(1));
                jthis.variables += code[0];
                return code[1] + &#x27;\n&#x27;;
            }
            if (code.indexOf(&#x27;!&#x27;) === 0) {
                jthis.variables += code.substr(1) + &quot;,&quot;;
                return &#x27;&#x27;;
            }
            if (code.indexOf(&#x27;@&#x27;) === 0) {
                return code.substr(1) + &#x27;\n&#x27;;
            }
            //  &lt;%=value%&gt; &lt;%==value%&gt;
            if (code.indexOf(&#x27;=&#x27;) === 0) {

                var isEscape = code.indexOf(&#x27;==&#x27;) !== 0;

                code = code.replace(/^=*|[\s;]*$/g, &#x27;&#x27;);

                if (isEscape &amp;&amp; js.isEscape) {

                    var name = code.replace(/\s*\([^\)]+\)/, &#x27;&#x27;);
                    code = &#x27;_$$(_$(&#x27; + code + &#x27;))&#x27;;

                } else {
                    code = &#x27;_$(&#x27; + code + &#x27;)&#x27;;
                }

                code = replaces[1] + code + replaces[2];

            }
            getKey(code);
            return code + &#x27;\n&#x27;;
        }

        function setValue(name, jthis) {
            var value;
            switch (name) {
                case &quot;$&quot;:
                    return;
                case &quot;print&quot;:
                    value = print;
                    break;
                case &quot;include&quot;:
                    value = include;
                    break;
                default :
                    if (name.indexOf(&#x27;$&#x27;) === 0) {
                        value = &#x27;jthis[&quot;&#x27; + name.substr(1) + &#x27;&quot;]&#x27;;
                    } else {
                        value = &#x27;jdata[&quot;&#x27; + name + &#x27;&quot;]&#x27;;
                    }
            }

            jthis.variables += name + &#x27;=&#x27; + value + &#x27;,&#x27;;
        }

        //
        jstatic({
            getHTML: function (id) {
                return document.getElementById(id).innerHTML;
            },
            openTag: &quot;[#&quot;, closeTag: &quot;#]&quot;, isCompress: false, isEscape: false,
            keywords: {
                &#x27;if&#x27;: function (code) {
                    return &#x27;if(&#x27; + code + &#x27;){&#x27;;
                },
                &#x27;else&#x27;: function (code) {
                    code = code.split(&#x27; &#x27;);

                    if (code.shift() === &#x27;if&#x27;) {
                        code = &#x27; if(&#x27; + code.join(&#x27; &#x27;) + &#x27;)&#x27;;
                    } else {
                        code = &#x27;&#x27;;
                    }

                    return &#x27;}else&#x27; + code + &#x27;{&#x27;;
                },

                &#x27;/if&#x27;: function () {
                    return &#x27;}&#x27;;
                },
                &#x27;each&#x27;: function (code) {

                    code = code.split(&#x27; &#x27;);

                    var object = code[0] || &#x27;jdata&#x27;;
                    var value = code[1] || &#x27;_v&#x27;;
                    var index = code[2] || &#x27;_i&#x27;;

                    var args = value + &#x27;,&#x27; + index;

                    return &#x27;$.each(&#x27; + object + &#x27;,function(&#x27; + args + &#x27;){&#x27;;
                },

                &#x27;/each&#x27;: function () {
                    return &#x27;});&#x27;;
                }
            },
            parser: function (code) {
                code = code.replace(/^\s/, &#x27;&#x27;);
                var args = code.split(&#x27; &#x27;);
                var key = args.shift();
                var keywords = this.keywords;
                var fuc = keywords[key];
                if (fuc &amp;&amp; keywords.hasOwnProperty(key)) {
                    args = args.join(&#x27; &#x27;);
                    code = fuc.call(code, args);
                }
                return code;
            },
            get: function (id, check) {
                var c = _cache[id];
                if (!c &amp;&amp; !check) {
                    c = new this(this.getHTML(id), {id: id});
                }
                return c;
            },
            apply: function (id, data) {
                return this.get(id).apply(data);
            },
            include: function (id) {
                return this.get(id).get();
            }
        });

        //
        jprotected({
            __$: function (content) {
                return typeof content === &#x27;string&#x27;
                    ? content.replace(/&amp;(?![\w#]+;)|[&lt;&gt;&quot;&#x27;]/g, function (s) {
                    return {
                        &quot;&lt;&quot;: &quot;&amp;#60;&quot;,
                        &quot;&gt;&quot;: &quot;&amp;#62;&quot;,
                        &#x27;&quot;&#x27;: &quot;&amp;#34;&quot;,
                        &quot;&#x27;&quot;: &quot;&amp;#39;&quot;,
                        &quot;&amp;&quot;: &quot;&amp;#38;&quot;
                    }[s];
                })
                    : content;
            },
            _$: function (value) {

                if (typeof value === &#x27;string&#x27; || typeof value === &#x27;number&#x27;) {
                    return value;
                } else if (typeof value === &#x27;function&#x27;) {
                    return value();
                } else {
                    return &#x27;&#x27;;
                }

            }
        });
        //
        jpublic({
            constructor: function () {
                jsuper(this);
                this.variables = &#x27;&#x27;;
                if (!this.html &amp;&amp; this.id) {
                    this.html = jstatic().getHTML(this.id);
                }
                this.compile(this.html);
            },
            apply: function (values) {
                return  this.compiled.call(this, values);
            },
            get: function () {
                return [this.variables, this.code];
            },
            toString: function () {
                return this.code;
            },
            debug: function () {
                console.log(&quot;variables:&quot; + this.variables);
                console.log(&quot;code:&quot; + this.code);
                return this;
            },
            compile: function (source) {
                var openTag = jstatic().openTag;
                var closeTag = jstatic().closeTag;


                var code = source.replace(/&lt;!--[^~]*?--&gt;/g, &quot;&quot;);
                var tempCode = &#x27;&#x27;;
                var jthis = this, js = jstatic();

                var uniq = {jthis: true, jdata: true};

                function getKey(code) {
                    code = getVariable(code);
                    //console.log(code);
                    $.each(code, function (name) {
                        if (!uniq.hasOwnProperty(name)) {
                            setValue(name, jthis);
                            uniq[name] = true;
                        }
                    });
                }

                $.each(code.split(openTag), function (code, i) {
                    code = code.split(closeTag);

                    var $0 = code[0];
                    var $1 = code[1];

                    // code: [html]
                    if (code.length === 1) {

                        tempCode += html($0, js);

                        // code: [logic, html]
                    } else {

                        tempCode += logic($0, js, getKey, jthis);

                        if ($1) {
                            tempCode += html($1, js);
                        }
                    }


                });


                code = tempCode;

                this.code = code;

                code = &quot;&#x27;use strict&#x27;;var jthis=this,_$=jthis[&#x27;_$&#x27;],__$=jthis[&#x27;__$&#x27;],&quot;
                    + jthis.variables + replaces[0] + &#x27; try{&#x27; + code + &#x27;}catch(e){}&#x27;
                    + &#x27;return &#x27; + replaces[3];

                if (js.debug) {
                    console.log(code);
                }

                this.compiled = new Function(&#x27;jdata&#x27;,  code);
                if (this.id) {
                    _cache[this.id] = this;
                }

            }
        });
    });

    $.extend(function ($) {
        return {
            xtpl: function (tpl) {
                var buf = [];
                var args = {};
                if ($.isArray(tpl)) {
                    tpl = tpl.join(&quot;&quot;);
                } else if (arguments.length &gt; 1) {
                    $.each($.toArray(arguments, 1), function (v) {
                        if ($.isObject(v)) {
                            $.extend(args, v);
                        } else {
                            buf.push(v);
                        }
                    });
                    tpl = buf.join(&#x27;&#x27;);
                }
                return new junit.JTemplate(tpl, args);
            },
            jtpl: function (id, tpl) {
                var t;
                if (id &amp;&amp; (t = junit.JTemplate.get(id, true))) {
                    return t;
                }
                var buf = [];
                var args = {id: id};
                if ($.isArray(tpl)) {
                    tpl = tpl.join(&quot;&quot;);
                } else if (arguments.length &gt; 1) {
                    $.each($.toArray(arguments, 1), function (v) {
                        if ($.isObject(v)) {
                            $.extend(args, v);
                        } else {
                            buf.push(v);
                        }
                    });
                    tpl = buf.join(&#x27;&#x27;);
                }
                return new junit.JTemplate(tpl, args);
            }
        }

    }($));

});
</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
